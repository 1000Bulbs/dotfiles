# Usage:
#   rails_console <ssh-host-alias> <rails-env>
#
#   rails_console strangler production   # production console on strangler
#   rails_console strangler staging      # staging console on strangler
#
# Requires two arguments:
#   $1 – SSH host alias (defined in ~/.ssh/config)
#   $2 – Rails environment (production, staging, qa, etc.)

rails_console() {
  local host=$1 env=$2

  # Ensure both arguments are provided
  if [[ -z $host || -z $env ]]; then
    print -u2 "rails_console: usage: rails_console <ssh-host> <rails-env>"
    return 1
  fi

  # Verify host is reachable (optional, quick noop command)
  if ! ssh -q "$host" exit 2>/dev/null; then
    print -u2 "rails_console: unknown or unreachable SSH host '$host'"
    return 1
  fi

  # Launch remote Rails console in the specified environment
  ssh "$host" -t '
    cd /var/apps/strangler/current &&
    exec bin/rails console -e '"$env"''
}
